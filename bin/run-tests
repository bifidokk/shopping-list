#!/usr/bin/env bash

set -e

# Colors for output
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${YELLOW}Starting test database...${NC}"
docker compose --profile test up -d database_test

echo -e "${YELLOW}Waiting for database to be ready...${NC}"
sleep 2

echo -e "${YELLOW}Creating test database and running migrations...${NC}"
php bin/console doctrine:database:create --env=test --if-not-exists
php bin/console doctrine:migrations:migrate --env=test --no-interaction

echo -e "${GREEN}✓ Test database ready!${NC}"
echo ""
echo -e "${YELLOW}Running tests...${NC}"
vendor/bin/phpunit "$@"

echo ""
echo -e "${GREEN}✓ Tests completed!${NC}"
echo ""
echo -e "${YELLOW}To stop the test database, run:${NC}"
echo "  docker compose --profile test down"
